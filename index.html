<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Animated Redirect Platform</title>
  <!-- Using Montserrat for a modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    /* Global body styles with animated gradient background */
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      height: 100vh;
      overflow: hidden;
      background: linear-gradient(45deg, #ff416c, #ff4b2b, #1fa2ff, #12d8fa, #a6ffcb, #ff9a9e, #fad0c4);
      background-size: 400% 400%;
      animation: gradientShift 15s infinite alternate, fadeIn 2s forwards;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    /* Container styles */
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
      color: white;
      padding: 20px;
    }
    /* Home page title using the new font */
    #home h1 {
      font-family: 'Montserrat', sans-serif;
      font-size: 2.5rem;
      margin-bottom: 30px;
    }
    /* Button styles shared by multiple buttons */
    button {
      padding: 15px 40px;
      font-size: 18px;
      font-weight: bold;
      color: white;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      margin: 10px;
    }
    button:hover {
      box-shadow: 0 6px 20px rgba(255, 255, 255, 0.5);
    }
    /* Create form styles */
    form {
      display: flex;
      flex-direction: column;
      width: 300px;
    }
    input[type="url"], textarea {
      padding: 8px;
      margin: 10px 0;
      border-radius: 4px;
      border: none;
    }
    /* Redirect button and animation effects (for redirection page) */
    .button-container {
      position: relative;
    }
    .redirect-button {
      padding: 15px 40px;
      font-size: 18px;
      font-weight: bold;
      color: white;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }
    .redirect-button:hover {
      box-shadow: 0 6px 20px rgba(255, 255, 255, 0.5);
    }
    @keyframes shake {
      10%, 90% { transform: translateX(-2px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-4px); }
      40%, 60% { transform: translateX(4px); }
    }
    /* Loading label and tearing effect for redirection animations */
    .loading-label {
      position: absolute;
      font-size: 24px;
      color: white;
      opacity: 0;
    }
    .tearing {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      display: none;
      animation: tearEffect 1s forwards 3s;
    }
    @keyframes tearEffect {
      from { transform: scaleY(1); }
      to { transform: scaleY(0); }
    }
  </style>
</head>
<body>
  <!-- Home Section -->
  <div id="home" class="container">
    <h1>Welcome to the Redirection Platform</h1>
    <button onclick="location.hash='#create'">Create Redirection Link</button>
    <button onclick="location.hash='#search'">Search Redirection Links</button>
  </div>

  <!-- Create Link Section -->
  <div id="create" class="container" style="display:none;">
    <h1>Create a Redirection Link</h1>
    <form onsubmit="createRedirectLink(event)">
      <label for="destination">Destination URL:</label>
      <input type="url" id="destination" required placeholder="https://example.com">
      <label for="detail">Detail (optional):</label>
      <textarea id="detail" rows="3" placeholder="Describe this link..."></textarea>
      <button type="submit">Create Link</button>
    </form>
    <button onclick="location.hash='#home'">Back</button>
    <div id="create-result" style="margin-top:20px;"></div>
  </div>

  <!-- Search Link Section -->
  <div id="search" class="container" style="display:none;">
    <h1>Search Redirection Links</h1>
    <input type="text" id="searchInput" placeholder="Search by ID, URL, or detail...">
    <ul id="searchResults" style="list-style: none; padding: 0; margin-top:20px;"></ul>
    <button onclick="location.hash='#home'">Back</button>
  </div>

  <!-- Redirection Page Section -->
  <div id="redirect-page" class="container" style="display:none; position: relative; overflow-y: auto;">
    <div class="button-container">
      <button class="redirect-button" onclick="redirect()">Go</button>
    </div>
    <div class="loading-label" id="loading-label">Loading the redirection link...</div>
    <div class="tearing" id="tearing"></div>
    <div id="redirect-details" style="margin-top: 50px; color: white; display: none; text-align: center;">
      <!-- Details will be populated here upon scroll -->
    </div>
    <button style="position:absolute; top:20px; right:20px;" onclick="location.hash='#home'">Home</button>
  </div>

  <script>
    // Navigation: show/hide sections based on URL hash
    function navigate() {
      // Hide all containers
      document.getElementById('home').style.display = 'none';
      document.getElementById('create').style.display = 'none';
      document.getElementById('search').style.display = 'none';
      document.getElementById('redirect-page').style.display = 'none';

      const hash = window.location.hash;
      if (hash.startsWith('#redirect-')) {
        document.getElementById('redirect-page').style.display = 'flex';
        loadRedirectPage();
      } else if (hash === '#create') {
        document.getElementById('create').style.display = 'flex';
      } else if (hash === '#search') {
        document.getElementById('search').style.display = 'flex';
        updateSearchResults();
      } else {
        // Default to home
        document.getElementById('home').style.display = 'flex';
      }
    }
    window.onhashchange = navigate;
    navigate();

    // Utility functions for localStorage
    function getRedirectLinks() {
      let links = localStorage.getItem('redirectLinks');
      if (!links) {
        return [];
      }
      return JSON.parse(links);
    }
    function saveRedirectLinks(links) {
      localStorage.setItem('redirectLinks', JSON.stringify(links));
    }

    // Create redirection link function (only one per browser/IP simulated via localStorage)
    function createRedirectLink(e) {
      e.preventDefault();
      if (localStorage.getItem('myCreatedLink')) {
        alert('You have already created a redirection link.');
        return;
      }
      const destination = document.getElementById('destination').value;
      const detail = document.getElementById('detail').value;
      let counter = parseInt(localStorage.getItem('redirectCounter') || '0');
      counter++;
      const id = counter + 'p';
      localStorage.setItem('redirectCounter', counter);
      const links = getRedirectLinks();
      links.push({ id: id, destination: destination, detail: detail });
      saveRedirectLinks(links);
      localStorage.setItem('myCreatedLink', id);
      document.getElementById('create-result').innerText =
        'Your redirection link is: ' + window.location.origin + '/#redirect-' + id +
        ' (displayed as ' + counter + ')';
    }

    // Update search results by filtering through stored links
    function updateSearchResults() {
      const input = document.getElementById('searchInput').value.toLowerCase();
      const links = getRedirectLinks();
      const ul = document.getElementById('searchResults');
      ul.innerHTML = '';
      links.forEach(link => {
        const displayId = link.id.slice(0, -1); // remove trailing 'p'
        if (displayId.includes(input) ||
            link.destination.toLowerCase().includes(input) ||
            (link.detail && link.detail.toLowerCase().includes(input))) {
          const li = document.createElement('li');
          li.style.marginBottom = '10px';
          li.innerText = displayId + ': ' + link.destination + (link.detail ? (' - ' + link.detail) : '');
          // Clicking a search result takes you to the redirection page
          li.style.cursor = 'pointer';
          li.onclick = function() {
            location.hash = '#redirect-' + link.id;
          };
          ul.appendChild(li);
        }
      });
    }
    document.getElementById('searchInput').addEventListener('input', updateSearchResults);

    // Global variable to hold current redirection link data
    let currentLink = null;
    // Load redirection page details based on hash
    function loadRedirectPage() {
      const hash = window.location.hash;
      const id = hash.replace('#redirect-', '');
      const links = getRedirectLinks();
      currentLink = links.find(l => l.id === id);
      if (!currentLink) {
        alert('Redirection link not found.');
        location.hash = '#home';
        return;
      }
      // Populate details (hidden by default, but revealed on scroll)
      const detailsDiv = document.getElementById('redirect-details');
      detailsDiv.innerHTML = '<p>Destination: ' + currentLink.destination + '</p>' +
                             (currentLink.detail ? '<p>Detail: ' + currentLink.detail + '</p>' : '');
    }

    // Listen for scroll events on the redirection page to show/hide details
    window.addEventListener('scroll', function() {
      if (window.location.hash.startsWith('#redirect-')) {
        if (window.scrollY > 100) {
          document.getElementById('redirect-details').style.display = 'block';
        } else {
          document.getElementById('redirect-details').style.display = 'none';
        }
      }
    });

    // Redirection button animation sequence
    function redirect() {
      if (!currentLink) return;
      const button = document.querySelector('.redirect-button');
      button.style.animation = 'shake 1s forwards';
      setTimeout(() => {
        button.style.display = 'none';
        document.getElementById('tearing').style.display = 'block';
        document.getElementById('loading-label').style.display = 'block';
        document.getElementById('loading-label').style.animation = 'fadeIn 1s forwards';
        setTimeout(() => {
          document.body.style.animation = 'fadeOut 2s forwards';
          setTimeout(() => {
            window.location.href = currentLink.destination;
          }, 2000);
        }, 1000);
      }, 1000);
    }
  </script>
</body>
</html>
